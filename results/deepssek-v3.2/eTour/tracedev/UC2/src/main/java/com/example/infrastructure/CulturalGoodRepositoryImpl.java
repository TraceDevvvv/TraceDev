package com.example.infrastructure;

import com.example.domain.CulturalGoodAggregate;
import com.example.domain.Location;

/**
 * Implementation of CulturalGoodRepository that connects to an external ETOUR server.
 */
public class CulturalGoodRepositoryImpl implements CulturalGoodRepository {
    // Simulating dependencies
    private Object dataSource; // In real scenario, a DB connection pool
    private Object etourServer; // Reference to ETOUR server
    
    public CulturalGoodRepositoryImpl(Object dataSource, Object etourServer) {
        this.dataSource = dataSource;
        this.etourServer = etourServer;
    }
    
    @Override
    public boolean existsByNameAndLocation(String name, Location location) throws ConnectionException {
        // Simulate checking for duplicates.
        // In a real implementation, this would query the database/external system.
        // For demonstration, we assume no duplicates unless name contains "duplicate".
        if (name != null && name.toLowerCase().contains("duplicate")) {
            return true;
        }
        return false;
    }
    
    @Override
    public CulturalGoodAggregate save(CulturalGoodAggregate culturalGood) throws ConnectionException {
        // Simulate saving to an external server.
        // Simulate connection interruption if the name contains "connectionerror".
        if (culturalGood.getName() != null && culturalGood.getName().toLowerCase().contains("connectionerror")) {
            throw new ConnectionException("Connection to ETOUR server interrupted.");
        }
        
        // In a real implementation, the ID might be generated by the database.
        // Here we just return the same object.
        return culturalGood;
    }
}