package com.example.repository;

import com.example.model.News;
import javax.sql.DataSource;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;

/**
 * In-memory implementation of NewsRepository for demonstration.
 * Assumes a DataSource is available but not used in this simple version.
 */
public class NewsRepositoryImpl implements NewsRepository {
    private DataSource dataSource;
    private Map<String, News> newsStore = new HashMap<>();

    public NewsRepositoryImpl(DataSource dataSource) {
        this.dataSource = dataSource;
        // Initialize with some dummy data for demonstration
        initializeDummyData();
    }

    private void initializeDummyData() {
        News news1 = new News("1", "News Title 1", "Content 1", "Author 1");
        News news2 = new News("2", "News Title 2", "Content 2", "Author 2");
        newsStore.put(news1.getId(), news1);
        newsStore.put(news2.getId(), news2);
    }

    @Override
    public List<News> findAll() {
        return new ArrayList<>(newsStore.values());
    }

    @Override
    public Optional<News> findById(String id) {
        return Optional.ofNullable(newsStore.get(id));
    }

    @Override
    public News save(News news) {
        // If news has no ID, generate one (simplistic).
        if (news.getId() == null || news.getId().isEmpty()) {
            // This is a simplification; in real scenario ID might be generated by DB.
            String newId = String.valueOf(newsStore.size() + 1);
            // Since News.id has no setter, we cannot change it. Assume the news object already has an ID.
            // For update scenario, the ID already exists.
        }
        newsStore.put(news.getId(), news);
        return news;
    }
}