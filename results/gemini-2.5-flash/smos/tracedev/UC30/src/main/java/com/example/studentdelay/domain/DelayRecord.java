package com.example.studentdelay.domain;

import com.example.studentdelay.dataaccess.StudentDelayDTO;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Objects;

/**
 * Represents a Delay Record in the domain model.
 * This is a core entity.
 */
public class DelayRecord {
    private String id; // Unique identifier for the record
    private String studentId;
    private LocalDate delayDate;
    private String reason;
    private LocalDateTime entryTimestamp;

    // Private constructor to enforce creation via static factory method
    private DelayRecord(String id, String studentId, LocalDate delayDate, String reason, LocalDateTime entryTimestamp) {
        this.id = id;
        this.studentId = studentId;
        this.delayDate = delayDate;
        this.reason = reason;
        this.entryTimestamp = entryTimestamp;
    }

    /**
     * Factory method to create a new DelayRecord.
     * The 'id' might be null initially if it's generated by the persistence layer.
     *
     * @param studentId The ID of the student.
     * @param delayDate The date of the delay.
     * @param reason The reason for the delay.
     * @return A new DelayRecord instance.
     */
    public static DelayRecord create(String studentId, LocalDate delayDate, String reason) {
        // ID is often assigned by the data access layer upon persistence
        return new DelayRecord(null, studentId, delayDate, reason, LocalDateTime.now());
    }

    /**
     * Converts this DelayRecord domain entity to a StudentDelayDTO.
     * Note: studentName cannot be populated here as it requires a Student object,
     * which is typically handled in a service layer after fetching student details.
     *
     * @return A StudentDelayDTO representing this DelayRecord.
     */
    public StudentDelayDTO toDTO() {
        return new StudentDelayDTO(this.id, this.studentId, null, this.delayDate, this.reason, this.entryTimestamp);
    }

    // Getters
    public String getId() {
        return id;
    }

    public String getStudentId() {
        return studentId;
    }

    public LocalDate getDelayDate() {
        return delayDate;
    }

    public String getReason() {
        return reason;
    }

    public LocalDateTime getEntryTimestamp() {
        return entryTimestamp;
    }

    // Setters (for 'id' specifically, if assigned post-creation by persistence)
    public void setId(String id) {
        this.id = id;
    }

    // Other setters are typically not exposed for domain entities once created
    // to maintain immutability or controlled state changes.
    // For this example, we'll allow setting entryTimestamp for deserialization/persistence.
    public void setEntryTimestamp(LocalDateTime entryTimestamp) {
        this.entryTimestamp = entryTimestamp;
    }

    public void setDelayDate(LocalDate delayDate) {
        this.delayDate = delayDate;
    }

    public void setReason(String reason) {
        this.reason = reason;
    }

    public void setStudentId(String studentId) {
        this.studentId = studentId;
    }

    @Override
    public String toString() {
        return "DelayRecord{" +
               "id='" + id + '\'' +
               ", studentId='" + studentId + '\'' +
               ", delayDate=" + delayDate +
               ", reason='" + reason + '\'' +
               ", entryTimestamp=" + entryTimestamp +
               '}';
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        DelayRecord that = (DelayRecord) o;
        return Objects.equals(id, that.id) &&
               Objects.equals(studentId, that.studentId) &&
               Objects.equals(delayDate, that.delayDate) &&
               Objects.equals(reason, that.reason) &&
               Objects.equals(entryTimestamp, that.entryTimestamp);
    }

    @Override
    public int hashCode() {
        return Objects.hash(id, studentId, delayDate, reason, entryTimestamp);
    }
}