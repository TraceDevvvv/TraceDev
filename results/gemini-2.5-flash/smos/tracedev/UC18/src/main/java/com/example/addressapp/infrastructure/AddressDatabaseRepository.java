package com.example.addressapp.infrastructure;

import com.example.addressapp.model.Address;
import java.util.HashMap;
import java.util.Map;

/**
 * Concrete implementation of AddressRepository that simulates database interaction.
 * Stores addresses in an in-memory map for demonstration purposes.
 * Can simulate connection errors by throwing SMOSConnectionException based on specific input.
 */
public class AddressDatabaseRepository implements AddressRepository {
    // A simple in-memory store for demonstration purposes
    private final Map<String, Address> addressStore = new HashMap<>();

    /**
     * Saves an Address object.
     * Simulates a database save operation. If the address name is "error" or "exception",
     * it simulates a connection error by throwing SMOSConnectionException.
     *
     * @param address The Address object to be saved.
     * @throws SMOSConnectionException If the address name triggers a simulated connection error.
     */
    @Override
    public void save(Address address) throws SMOSConnectionException {
        System.out.println("[Repo] Attempting to save address: " + address.getName());
        // Simulate a connection error
        if (address.getName() != null &&
            (address.getName().equalsIgnoreCase("error") || address.getName().equalsIgnoreCase("exception"))) {
            System.out.println("[Repo] Simulating SMOSConnectionException for '" + address.getName() + "'");
            throw new SMOSConnectionException("Simulated connection error to SMOS server for address: " + address.getName());
        }

        // Simulate database insertion/update
        addressStore.put(address.getId(), address);
        System.out.println("[Repo] Address saved successfully with ID: " + address.getId() + " Name: " + address.getName());
        // In a real scenario, the ID might be generated by the database and set back into the address object.
        // For this simulation, the ID is generated by the Address constructor.
    }
}