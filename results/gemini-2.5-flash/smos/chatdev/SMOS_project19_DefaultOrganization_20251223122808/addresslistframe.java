'''
Implements the GUI for viewing a list of addresses.
'''
package com.chatdev.gui;
import com.chatdev.model.Address;
import com.chatdev.service.AddressService;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.List;
/**
 * This JFrame displays a list of addresses and allows the user (Administrator)
 * to select an address and view its detailed information.
 * This simulates the "ViewingLenchIndirizzi" use case precondition.
 */
public class AddressListFrame extends JFrame implements ActionListener {
    private AddressService addressService;
    private JList<Address> addressJList;
    private DefaultListModel<Address> listModel;
    private JButton showDetailsButton;
    /**
     * Constructs an AddressListFrame.
     *
     * @param addressService The service responsible for fetching address data.
     */
    public AddressListFrame(AddressService addressService) {
        super("Address Management - Address List");
        this.addressService = addressService;
        // --- Frame Setup ---
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); // Exit application when this frame closes
        setSize(400, 300);
        setLayout(new BorderLayout(10, 10)); // Use BorderLayout for overall frame structure
        // --- Components Initialization ---
        listModel = new DefaultListModel<>();
        addressJList = new JList<>(listModel);
        addressJList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION); // Allow only one selection at a time
        setupListRenderer(); // Set a custom renderer for clearer address display in the list
        JScrollPane scrollPane = new JScrollPane(addressJList);
        scrollPane.setBorder(BorderFactory.createTitledBorder("Available Addresses"));
        showDetailsButton = new JButton("Show Address Details");
        showDetailsButton.addActionListener(this); // Register action listener for the button
        // --- Add Components to Frame ---
        add(scrollPane, BorderLayout.CENTER); // List occupies the central area
        add(showDetailsButton, BorderLayout.SOUTH); // Button placed at the bottom
        // Add some padding around the content panel for better aesthetics
        ((JPanel) getContentPane()).setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        // Load addresses into the list upon initialization of the frame
        loadAddresses();
    }
    /**
     * Loads addresses from the AddressService and populates the JList.
     * This method is called upon frame construction to show the initial list.
     */
    private void loadAddresses() {
        listModel.clear(); // Clear any existing items before loading new ones
        List<Address> addresses = addressService.getAllAddresses();
        for (Address address : addresses) {
            listModel.addElement(address); // Add each address to the list model
        }
        if (!addresses.isEmpty()) {
            addressJList.setSelectedIndex(0); // Select the first item by default for convenience
        }
    }
    /**
     * Sets a custom list cell renderer to display more detailed information
     * in the JList than just the address name (the default toString() output).
     * This provides a richer user experience for selecting an address.
     */
    private void setupListRenderer() {
        addressJList.setCellRenderer(new DefaultListCellRenderer() {
            @Override
            public Component getListCellRendererComponent(JList<?> list, Object value, int index, boolean isSelected, boolean cellHasFocus) {
                JLabel label = (JLabel) super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
                // If the value is an Address object, format its display text
                if (value instanceof Address) {
                    Address address = (Address) value;
                    label.setText(String.format("ID: %s - Name: %s (%s, %s)",
                            address.getId(), address.getName(), address.getCity(), address.getCountry()));
                }
                return label;
            }
        });
    }
    /**
     * Handles action events from the GUI components, specifically the "Show Address Details" button.
     * This method is triggered when the user clicks the button.
     *
     * @param e The ActionEvent generated by the component.
     */
    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() == showDetailsButton) {
            Address selectedAddress = addressJList.getSelectedValue();
            if (selectedAddress != null) {
                // Preconditions fulfilled: user logged in, list viewed, button clicked.
                // Event sequence: System displays the screen with details.
                AddressDetailFrame detailFrame = new AddressDetailFrame(addressService, selectedAddress.getId());
                detailFrame.setLocationRelativeTo(this); // Center the detail frame relative to the list frame
                detailFrame.setVisible(true); // Make the detail frame visible
            } else {
                // Edge case: No address was selected by the user.
                JOptionPane.showMessageDialog(this,
                        "Please select an address from the list to view its details.",
                        "No Address Selected",
                        JOptionPane.WARNING_MESSAGE);
            }
        }
    }
}