'''
Main application class creating a GUI for student to view their school data.
It simulates fetching data from an SMOS server and displays it in a table.
This class assumes the user is already logged in as a student.
'''
import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.List;
import java.util.Vector;
public class StudentApp extends JFrame implements ActionListener {
    private JButton digitalLogButton;
    private JTable dataTable;
    private DefaultTableModel tableModel;
    private JLabel statusLabel;
    // Hardcoding a student ID for demonstration purposes
    private static final String CURRENT_STUDENT_ID = "student_12345";
    /**
     * Constructor for the StudentApp. Sets up the GUI components.
     */
    public StudentApp() {
        // --- Frame Setup ---
        setTitle("Student Digital Log - View School Data");
        setSize(800, 600);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null); // Center the window
        // --- UI Components ---
        // Main panel with BorderLayout
        JPanel mainPanel = new JPanel(new BorderLayout());
        getContentPane().add(mainPanel);
        // Header panel for the button
        JPanel headerPanel = new JPanel(new FlowLayout(FlowLayout.CENTER));
        digitalLogButton = new JButton("Digital Log");
        digitalLogButton.addActionListener(this); // Register action listener
        digitalLogButton.setFont(new Font("SansSerif", Font.BOLD, 16));
        headerPanel.add(digitalLogButton);
        mainPanel.add(headerPanel, BorderLayout.NORTH);
        // Table for displaying student data
        String[] columnNames = {"Date", "Absences", "Disciplinary Notes", "Delays", "Justification"};
        tableModel = new DefaultTableModel(columnNames, 0) {
            @Override
            public boolean isCellEditable(int row, int column) {
                // Make cells non-editable
                return false;
            }
        };
        dataTable = new JTable(tableModel);
        dataTable.setFillsViewportHeight(true); // Fills the table to the height of the scroll pane
        dataTable.setFont(new Font("SansSerif", Font.PLAIN, 12));
        dataTable.setRowHeight(25); // Set row height for better readability
        JScrollPane scrollPane = new JScrollPane(dataTable);
        mainPanel.add(scrollPane, BorderLayout.CENTER);
        // Status label at the bottom
        statusLabel = new JLabel("Click 'Digital Log' to view your class registry data.", SwingConstants.CENTER);
        statusLabel.setForeground(Color.BLUE);
        statusLabel.setFont(new Font("SansSerif", Font.ITALIC, 14));
        mainPanel.add(statusLabel, BorderLayout.SOUTH);
        setVisible(true); // Make the frame visible
    }
    /**
     * Handles action events, specifically the "Digital Log" button click.
     *
     * @param e The ActionEvent generated by the button click.
     */
    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() == digitalLogButton) {
            // Update status label to indicate data loading
            statusLabel.setForeground(Color.ORANGE);
            statusLabel.setText("Searching archive for your data...");
            // Use a SwingWorker for long-running tasks to keep the GUI responsive
            SwingWorker<List<StudentData>, Void> worker = new SwingWorker<List<StudentData>, Void>() {
                @Override
                protected List<StudentData> doInBackground() throws Exception {
                    // Each button click initiates a new connection attempt and data fetching session.
                    SMOSService smosService = new SMOSService(); // Establish a new connection for this request
                    List<StudentData> studentData = smosService.fetchStudentData(CURRENT_STUDENT_ID);
                    // Postcondition: Connecting to the SMOS server interrupted for this session
                    smosService.interruptConnection(); // Interrupt the connection after data is fetched
                    return studentData;
                }
                @Override
                protected void done() {
                    try {
                        List<StudentData> studentDataList = get(); // Get result from doInBackground
                        updateDataTable(studentDataList); // Update GUI with fetched data
                        // Postcondition: Student's class registry data was shown
                        statusLabel.setForeground(Color.BLACK); // Set color for successful display
                        statusLabel.setText("Student's class registry data was shown. Connection to SMOS server interrupted.");
                        // The digitalLogButton remains enabled to allow viewing data again.
                    } catch (Exception ex) {
                        // Handle exceptions during data fetching or display
                        statusLabel.setForeground(Color.RED);
                        statusLabel.setText("Error retrieving data: " + ex.getMessage() + ". Please try again.");
                        ex.printStackTrace();
                    }
                }
            };
            worker.execute(); // Execute the SwingWorker
        }
    }
    /**
     * Populates the JTable with the provided student data.
     *
     * @param studentDataList A list of StudentData objects to display.
     */
    private void updateDataTable(List<StudentData> studentDataList) {
        tableModel.setRowCount(0); // Clear existing data from the table
        if (studentDataList.isEmpty()) {
            // Handle case where no data is found or an empty list is returned
            Vector<String> row = new Vector<>();
            row.add("N/A");
            row.add("N/A");
            row.add("No data available for this student or connection failed.");
            row.add("N/A");
            row.add("N/A");
            tableModel.addRow(row);
            return;
        }
        // Add each StudentData object as a new row in the table
        for (StudentData data : studentDataList) {
            Vector<Object> row = new Vector<>();
            row.add(data.getDate());
            row.add(data.getAbsences());
            row.add(data.getDisciplinaryNotes());
            row.add(data.getDelays());
            row.add(data.getJustification());
            tableModel.addRow(row);
        }
    }
    /**
     * Main method to run the StudentApp.
     *
     * @param args Command line arguments (not used).
     */
    public static void main(String[] args) {
        // Ensure GUI updates are run on the Event Dispatch Thread (EDT)
        SwingUtilities.invokeLater(StudentApp::new);
    }
}