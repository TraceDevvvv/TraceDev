/*
 * GUI panel for selecting an academic year.
 * Once a year is selected, it notifies its listener.
 */
package gui;
import data.DataStore;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.util.List;
import java.util.function.Consumer;
public class AcademicYearPanel extends JPanel {
    private JComboBox<String> yearComboBox;
    private JButton nextButton;
    private Consumer<String> onYearSelected; // Callback for when a year is selected
    private DataStore dataStore; // Add DataStore instance
    /**
     * Constructs a new AcademicYearPanel.
     * @param dataStore The DataStore instance for retrieving academic years.
     * @param onYearSelected A callback function to be executed when an academic year is selected.
     *                       The selected year string is passed as an argument.
     */
    public AcademicYearPanel(DataStore dataStore, Consumer<String> onYearSelected) { // Modify constructor
        this.dataStore = dataStore; // Assign dataStore
        this.onYearSelected = onYearSelected;
        setLayout(new BorderLayout(10, 10));
        setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));
        // Panel for title
        JPanel titlePanel = new JPanel();
        titlePanel.add(new JLabel("<html><h2>Select Academic Year</h2></html>"));
        add(titlePanel, BorderLayout.NORTH);
        // Panel for controls
        JPanel controlPanel = new JPanel(new FlowLayout());
        controlPanel.add(new JLabel("Academic Year:"));
        yearComboBox = new JComboBox<>();
        populateAcademicYears();
        controlPanel.add(yearComboBox);
        nextButton = new JButton("Next");
        // Add action listener to the next button
        nextButton.addActionListener(this::handleNextButtonClick);
        controlPanel.add(nextButton);
        add(controlPanel, BorderLayout.CENTER);
        // Initially disable button if no years are available
        if (yearComboBox.getItemCount() == 0) {
            nextButton.setEnabled(false);
        }
    }
    /**
     * Populates the academic year combo box with data from the DataStore.
     */
    private void populateAcademicYears() {
        // Use the injected DataStore instance
        List<String> years = dataStore.getAcademicYears();
        for (String year : years) {
            yearComboBox.addItem(year);
        }
    }
    /**
     * Handles the click event for the "Next" button.
     * Retrieves the selected academic year and invokes the callback.
     * @param e The ActionEvent generated by the button click.
     */
    private void handleNextButtonClick(ActionEvent e) {
        String selectedYear = (String) yearComboBox.getSelectedItem();
        if (selectedYear != null) {
            if (onYearSelected != null) {
                onYearSelected.accept(selectedYear);
            }
        } else {
            JOptionPane.showMessageDialog(this, "Please select an academic year.", "Selection Error", JOptionPane.WARNING_MESSAGE);
        }
    }
    /**
     * Resets the panel's display to an initial state, clearing any previous selections.
     * This method is called when returning to this panel from a later step.
     */
    public void resetPanel() {
        // Clear selection, or set to the first item if available
        if (yearComboBox.getItemCount() > 0) {
            yearComboBox.setSelectedIndex(0);
        } else {
            yearComboBox.setSelectedItem(null); // No items, clear selection
        }
        // Ensure "Next" button is enabled if there are academic years
        nextButton.setEnabled(yearComboBox.getItemCount() > 0);
    }
}