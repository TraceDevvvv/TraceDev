/*
 * GUI panel for displaying the generated student report card.
 * It shows the student's details, academic year, selected months, and course grades.
 */
package gui;
import model.CourseGrade;
import model.ReportCard;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.util.List;
import java.util.Map;
import java.util.function.Consumer;
public class ReportDisplayPanel extends JPanel {
    private JEditorPane reportPane; // Using JEditorPane for formatted text (HTML)
    private JButton newReportButton;
    private Consumer<Void> onNewReportRequested; // Callback to initiate a new report process
    /**
     * Constructs a new ReportDisplayPanel.
     * @param onNewReportRequested A callback function to be executed when the "New Report" button is clicked.
     */
    public ReportDisplayPanel(Consumer<Void> onNewReportRequested) {
        this.onNewReportRequested = onNewReportRequested;
        setLayout(new BorderLayout(10, 10));
        setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));
        // Title Panel
        JPanel titlePanel = new JPanel();
        titlePanel.add(new JLabel("<html><h2>Student Report Card</h2></html>"));
        add(titlePanel, BorderLayout.NORTH);
        // Report display area
        reportPane = new JEditorPane();
        reportPane.setContentType("text/html"); // Allows displaying HTML content
        reportPane.setEditable(false); // Make it read-only
        JScrollPane scrollPane = new JScrollPane(reportPane);
        add(scrollPane, BorderLayout.CENTER);
        // Control Panel
        JPanel controlPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 10, 10));
        newReportButton = new JButton("View New Report");
        newReportButton.addActionListener(this::handleNewReportClick);
        controlPanel.add(newReportButton);
        add(controlPanel, BorderLayout.SOUTH);
    }
    /**
     * Displays the generated report card in a formatted manner (HTML).
     * @param reportCard The ReportCard object containing data to display.
     */
    public void displayReport(ReportCard reportCard) {
        if (reportCard == null) {
            reportPane.setText("<html><p style='color:red;'>Error: No report card data to display.</p></html>");
            return;
        }
        StringBuilder htmlContent = new StringBuilder();
        htmlContent.append("<html><body style='font-family: Arial, sans-serif; margin: 15px;'>");
        htmlContent.append("<h3>Student: ").append(reportCard.getStudent().getName()).append(" (ID: ").append(reportCard.getStudent().getId()).append(")</h3>");
        htmlContent.append("<p><b>Academic Year:</b> ").append(reportCard.getAcademicYear()).append("</p>");
        htmlContent.append("<p><b>Report for Months:</b> ").append(String.join(", ", reportCard.getMonths())).append("</p>");
        htmlContent.append("<hr/>");
        // Iterate through months and display grades
        for (String month : reportCard.getMonths()) {
            htmlContent.append("<h4><u>").append(month).append("</u></h4>");
            List<CourseGrade> grades = reportCard.getGradesByMonth().get(month);
            if (grades != null && !grades.isEmpty()) {
                htmlContent.append("<table border='1' cellpadding='5' cellspacing='0' style='width: 100%; text-align: left;'>");
                htmlContent.append("<tr><th>Course</th><th>Grade</th></tr>");
                for (CourseGrade grade : grades) {
                    htmlContent.append("<tr><td>").append(grade.getCourseName()).append("</td><td><b>").append(grade.getGrade()).append("</b></td></tr>");
                }
                htmlContent.append("</table>");
            } else {
                htmlContent.append("<p><i>No grades recorded for ").append(month).append(".</i></p>");
            }
            htmlContent.append("<br/>");
        }
        htmlContent.append("<p style='font-size: 0.9em; color: gray;'><i>Report generated successfully.</i></p>");
        htmlContent.append("</body></html>");
        reportPane.setText(htmlContent.toString());
        reportPane.setCaretPosition(0); // Scroll to top
    }
    /**
     * Handles the click event for the "New Report" button.
     * Invokes the callback to signal that a new report viewing process should start.
     * @param e The ActionEvent generated by the button click.
     */
    private void handleNewReportClick(ActionEvent e) {
        if (onNewReportRequested != null) {
            onNewReportRequested.accept(null); // No arguments needed for starting a new report
        }
    }
}